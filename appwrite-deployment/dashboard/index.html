<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitrage Detection Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
        }
        .opportunity-card {
            border-left: 4px solid #28a745;
            transition: transform 0.2s;
        }
        .opportunity-card:hover {
            transform: translateY(-2px);
        }
        .status-active {
            color: #28a745;
        }
        .status-expired {
            color: #dc3545;
        }
        .profit-positive {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="container">
            <h1 class="display-4">Synthetic Arbitrage Detection Engine</h1>
            <p class="lead">Real-time cryptocurrency arbitrage opportunities</p>
        </div>
    </div>

    <div class="container mt-4">
        <!-- Status Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title">Active Opportunities</h5>
                        <h2 id="active-count">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h5 class="card-title">Total Profit</h5>
                        <h2 id="total-profit">$0.00</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title">Exchanges</h5>
                        <h2 id="exchanges-count">3</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <h5 class="card-title">Avg Confidence</h5>
                        <h2 id="avg-confidence">0%</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Profit Opportunities Over Time</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Opportunities Table -->
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <h5>Active Arbitrage Opportunities</h5>
                <button class="btn btn-primary btn-sm" onclick="refreshData()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="card-body">
                <div id="opportunities-container">
                    <div class="text-center">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Appwrite
        const client = new Appwrite.Client()
            .setEndpoint('YOUR_APPWRITE_ENDPOINT') // Replace with your Appwrite endpoint
            .setProject('arbitrage-detection-engine');

        const functions = new Appwrite.Functions(client);
        const databases = new Appwrite.Databases(client);

        // Chart configuration
        const ctx = document.getElementById('profitChart').getContext('2d');
        const profitChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Profit Opportunities ($)',
                    data: [],
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Real-time Profit Tracking'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Load dashboard data
        async function loadDashboard() {
            try {
                // Get market data
                const marketResponse = await functions.createExecution(
                    'market-data-api',
                    JSON.stringify({ path: '/opportunities' })
                );
                
                const opportunities = JSON.parse(marketResponse.response);
                displayOpportunities(opportunities);
                updateStats(opportunities);
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showError('Failed to load dashboard data');
            }
        }

        // Display opportunities
        function displayOpportunities(opportunities) {
            const container = document.getElementById('opportunities-container');
            
            if (!opportunities || opportunities.length === 0) {
                container.innerHTML = '<div class="text-center text-muted">No active opportunities found</div>';
                return;
            }

            let html = '';
            opportunities.forEach(opp => {
                html += `
                    <div class="opportunity-card card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <h6 class="card-title">${opp.symbol}</h6>
                                    <small class="text-muted">${opp.exchange_a} â†’ ${opp.exchange_b}</small>
                                </div>
                                <div class="col-md-2">
                                    <small class="text-muted">Price A</small>
                                    <div>$${opp.price_a.toFixed(2)}</div>
                                </div>
                                <div class="col-md-2">
                                    <small class="text-muted">Price B</small>
                                    <div>$${opp.price_b.toFixed(2)}</div>
                                </div>
                                <div class="col-md-2">
                                    <small class="text-muted">Profit</small>
                                    <div class="profit-positive">$${opp.profit_potential.toFixed(2)}</div>
                                </div>
                                <div class="col-md-2">
                                    <small class="text-muted">Confidence</small>
                                    <div>${(opp.confidence_score * 100).toFixed(1)}%</div>
                                </div>
                                <div class="col-md-1">
                                    <span class="badge ${opp.status === 'active' ? 'bg-success' : 'bg-danger'}">
                                        ${opp.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update statistics
        function updateStats(opportunities) {
            const activeCount = opportunities.filter(o => o.status === 'active').length;
            const totalProfit = opportunities.reduce((sum, o) => sum + o.profit_potential, 0);
            const avgConfidence = opportunities.reduce((sum, o) => sum + o.confidence_score, 0) / opportunities.length;

            document.getElementById('active-count').textContent = activeCount;
            document.getElementById('total-profit').textContent = `$${totalProfit.toFixed(2)}`;
            document.getElementById('avg-confidence').textContent = `${(avgConfidence * 100).toFixed(1)}%`;
        }

        // Refresh data
        function refreshData() {
            loadDashboard();
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('opportunities-container');
            container.innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboard, 30000);
        });
    </script>
</body>
</html>
